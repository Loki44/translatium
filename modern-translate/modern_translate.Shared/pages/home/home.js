!function(){"use strict";var i,t=WinJS.Utilities,e=WinJS.Binding,n=WinJS.UI,a=WinJS.Application,s=WinJS.Navigation,o=Windows.Storage.ApplicationData.current,r=o.localSettings,l=o.roamingSettings;n.Pages.define("/pages/home/home.html",{ready:function(i,n){var o=this;this.liveCardTemplate=i.querySelector(".live-card-template").winControl,this.normalCardTemplate=i.querySelector(".normal-card-template").winControl,this.progressHistory=i.querySelector(".history-footer .progress"),this.progressFavorites=i.querySelector(".favorites-footer .progress"),this.dtInputLang=i.querySelector("#dt-input-lang"),this.imeContainer=i.querySelector(".ime-container"),this.backDrop=i.querySelector(".backdrop"),this.selectLanguage=i.querySelector(".select-language"),this.inputBox=i.querySelector("#input-box"),this.pivotView=i.querySelector("#pivot").winControl,this.toolBar=i.querySelector(".toolbar").winControl,1==l.values["prevent-lock"]&&null==window.dispRequest&&(window.dispRequest=new Windows.System.Display.DisplayRequest,window.dispRequest.requestActive());var u=!1,g=!1;this.bindingData=e.as({labelClearHistory:WinJS.Resources.getString("clear_history").value,selectMode:"hidden",imeMode:"",inputLang:"undefined"==typeof r.values.inputLang?"en":r.values.inputLang,tmpinputLang:r.values.inputLang,outputLang:"undefined"==typeof r.values.outputLang?"es":r.values.outputLang,inputText:a.sessionState.inputText?a.sessionState.inputText:"",expandinputBox:!1,isPremium:Custom.Utils.isPremium(),languageTemplate:e.initializer(function(i){return i.then(function(i){var t=document.createElement("div");return t.className="language-item material-text",t.innerText=i.data.language_name?i.data.language_name:WinJS.Resources.getString(i.data.language_id).value,t})}),languageGroupTemplate:e.initializer(function(i){return i.then(function(i){var t=document.createElement("div");return t.className="language-group material-text themed-text",1==i.data.main?t.innerText=WinJS.Resources.getString("all").value:(t.innerText=WinJS.Resources.getString("recent").value,t.style.marginTop="10px"),t})}),languageInvoked:e.initializer(function(i){o.hideDropdown();var t=i.detail.itemIndex,e=Custom.Data.groupedlanguageList.getAt(t).language_id;"inputLang"==o.bindingData.selectMode&&("auto"!=o.bindingData.inputLang&&e==o.bindingData.outputLang?o.swapLanguage():o.bindingData.inputLang=e),"outputLang"==o.bindingData.selectMode&&(e==o.bindingData.inputLang?o.swapLanguage():o.bindingData.outputLang=e)}),cardTemplate:e.initializer(function(i){return i.then(function(t){return"live"===t.data.type?o.liveCardTemplate.renderItem(i):o.normalCardTemplate.renderItem(i)})}),cardLayout:{type:WinJS.Class.define(function(i){this._site=null,this._surface=null},{initialize:function(i){return this._site=i,this._surface=this._site.surface,WinJS.Utilities.addClass(this._surface,"card-layout"),WinJS.UI.Orientation.vertical},uninitialize:function(){WinJS.Utilities.removeClass(this._surface,"card-layout"),this._site=null,this._surface=null}})},historyList:new WinJS.Binding.List([]),loadmoreHistory:e.initializer(function(i){var e=i?i.detail.visible:!0;return e?WinJS.Promise.as().then(function(){if(!u){u=!0,t.removeClass(o.progressHistory,"hide");var i="SELECT * FROM history ORDER BY id DESC LIMIT 0,5";if(o.bindingData.historyList.length>0){var e=o.bindingData.historyList.getAt(o.bindingData.historyList.length-1);"live"!=e.type&&(i="SELECT * FROM history WHERE id < "+e.id+" ORDER BY id DESC LIMIT 0,5")}return Custom.SQLite.localDatabase.executeAsync(i).then(function(i){i.forEach(function(i){var t=Custom.SQLite.entriestoObj(i.entries);o.bindingData.historyList.push(t)}),u=!1})}}).then(function(){t.addClass(o.progressHistory,"hide")}):void t.addClass(o.progressHistory,"hide")}),favoriteList:new WinJS.Binding.List([]),loadmoreFavorite:e.initializer(function(i){var e=i?i.detail.visible:!0;return e?WinJS.Promise.as().then(function(){if(!g){g=!0,t.removeClass(o.progressFavorites,"hide");var i="9223372036854775807";o.bindingData.favoriteList.length>0&&(i=o.bindingData.favoriteList.getAt(o.bindingData.favoriteList.length-1).id);var e="SELECT * FROM favorites WHERE id < "+i+" ORDER BY id DESC LIMIT 0,5";return Custom.SQLite.localDatabase.executeAsync(e).then(function(i){i.forEach(function(i){var t=Custom.SQLite.entriestoObj(i.entries);o.bindingData.favoriteList.push(t)}),g=!1})}}).then(function(){t.addClass(o.progressFavorites,"hide")}):void t.addClass(o.progressFavorites,"hide")}),onclickinputLang:e.initializer(function(i){o.bindingData.imeMode="","inputLang"==o.bindingData.selectMode?o.bindingData.selectMode="hidden":o.bindingData.selectMode="inputLang"}),onclickoutputLang:e.initializer(function(i){o.bindingData.imeMode="","outputLang"==o.bindingData.selectMode?o.bindingData.selectMode="hidden":o.bindingData.selectMode="outputLang"}),onclickbackDrop:e.initializer(function(){o.bindingData.selectMode="hidden"}),onclickSwap:e.initializer(function(i){o.swapLanguage()}),oninputText:e.initializer(function(i){o.bindingData.inputText=o.inputBox.value}),onkeydownText:0==l.values["enter-to-translate"]?null:e.initializer(function(i){13==(i.keyCode||i.which)&&(o.inputBox.blur(),i.preventDefault(),o.addTranslation())}),onclickClearHistory:e.initializer(function(i){if(o.bindingData.historyList.length>0){Custom.Utils.showNotif(WinJS.Resources.getString("clearing_history").value);var t=0;"live"==o.bindingData.historyList.getAt(0).type&&(t=1),o.bindingData.historyList.splice(t,o.bindingData.historyList.length);var e="DELETE FROM history";Custom.SQLite.localDatabase.executeAsync(e).then(function(){Custom.Utils.hideNotif()})}}),onclickAbout:e.initializer(function(i){s.navigate("/pages/about/about.html")}),onclickSettings:e.initializer(function(i){s.navigate("/pages/settings/settings.html")}),onclickPin:e.initializer(function(i){s.navigate("/pages/p-pin/p-pin.html")}),onclickBuyNow:e.initializer(function(i){s.navigate("/pages/premium/premium.html")}),onclickClear:e.initializer(function(i){o.bindingData.inputText=""}),onclickWrite:e.initializer(function(i){o.bindingData.imeMode="write"!=o.bindingData.imeMode?"write":"",""!=o.bindingData.imeMode&&(o.bindingData.expandinputBox=!1)}),onclickSpeak:e.initializer(function(i){return t.hasClass(this,"disabled")?void Custom.Utils.popupMsg(WinJS.Resources.getString("sorry").value,WinJS.Resources.getString("speech_not_available").value.replace("{1}",WinJS.Resources.getString(o.bindingData.inputLang).value)):(o.bindingData.imeMode="speak"!=o.bindingData.imeMode?"speak":"",void(""!=o.bindingData.imeMode&&(o.bindingData.expandinputBox=!1)))}),onclickCamera:e.initializer(function(e){if(t.hasClass(this,"disabled"))return void Custom.Utils.popupMsg(WinJS.Resources.getString("sorry").value,WinJS.Resources.getString("camera_not_available").value.replace("{1}",WinJS.Resources.getString(o.bindingData.inputLang).value));var n=new Windows.Storage.Pickers.FileOpenPicker;if(n.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.picturesLibrary,n.fileTypeFilter.append(".jpg"),n.fileTypeFilter.append(".jpeg"),n.fileTypeFilter.append(".png"),1==Custom.Device.isPhone)n.pickSingleFileAndContinue();else{var a=i.querySelector("#cameraMenu").winControl;a.show(this,"bottom")}}),onclickForward:e.initializer(function(i){o.addTranslation()}),onselectionchangedpivotView:e.initializer(function(i){var t=i.detail.item;1==o.pivotView.selectedIndex?(o.bindingData.historyList.splice(0,o.bindingData.historyList.length),o.bindingData.loadmoreFavorite().then(function(){0==o.bindingData.favoriteList.length?(t.element.querySelector(".empty").style.display="",t.element.querySelector("#favorite-list").style.display="none"):(t.element.querySelector(".empty").style.display="none",t.element.querySelector("#favorite-list").style.display="")})):0==o.pivotView.selectedIndex&&(o.bindingData.favoriteList.splice(0,o.bindingData.favoriteList.length),o.bindingData.loadmoreHistory())}),onclickExpand:e.initializer(function(i){o.bindingData.expandinputBox=!o.bindingData.expandinputBox,o.bindingData.imeMode=""}),onclickOutside:e.initializer(function(i){o.bindingData.imeMode=""}),onclickOpenCamera:e.initializer(function(){var i=new Windows.Media.Capture.CameraCaptureUI;return i.captureFileAsync(Windows.Media.Capture.CameraCaptureUIMode.photo).then(function(i){i&&s.navigate("/pages/p-camera/p-camera.html",{file:i})})}),onclickOpenGallery:e.initializer(function(){var i=new Windows.Storage.Pickers.FileOpenPicker;i.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.picturesLibrary,i.fileTypeFilter.append(".jpg"),i.fileTypeFilter.append(".jpeg"),i.fileTypeFilter.append(".png"),i.pickSingleFileAsync().done(function(i){i&&s.navigate("/pages/p-camera/p-camera.html",{file:i})})})}),e.processAll(i,this.bindingData),e.bind(this.bindingData,{inputLang:function(i){r.values.inputLang=i,o.bindingData.tmpinputLang=i,"auto"!=i&&o.updateRecent(),o.liveTranslation()},outputLang:function(i){r.values.outputLang=i,o.updateRecent(),o.liveTranslation()},selectMode:function(i){"hidden"==i?o.hideDropdown():o.showDropdown(o.bindingData.selectMode)},imeMode:function(i){o.imeControl&&(o.imeControl.dispose(),o.imeControl=null),o.imeContainer.className="ime-container",o.imeContainer.innerHTML="",o.applyText(),""!=i&&("write"==i&&(o.imeControl=new Custom.Control.Write(o.imeContainer)),"speak"==i&&(o.imeControl=new Custom.Control.Speak(o.imeContainer)),o.imeControl.onedit=function(i){0==i.eType?o.addText(i.eText):1==i.eType?o.deleteText():2==i.eType&&o.applyText()})},inputText:function(i){o.inputBox.value!=i&&(o.inputBox.value=i),a.sessionState.inputText=i,o.liveTranslation()},expandinputBox:function(i,t){1==t&&(o.pivotView.selectedItem.element.style.transform="translate(-"+o.pivotView.selectedItem.element.style.left+", 0px)")}}),this.toolBar.forceLayout()},unload:function(i,t){window.soundPromise&&window.soundPromise.cancel(),null!=window.dispRequest&&(window.dispRequest.requestRelease(),window.dispRequest=null)},updateLayout:function(i,t){this.bindingData.imeMode=""},deleteText:function(){var i=this.inputBox.querySelector(".new-text");if(i)i.innerText="",i.className="";else{var t=this.inputBox.value;t.length>0&&(this.bindingData.inputText=t.substr(0,t.length-1))}},addText:function(i){var t=this.inputBox.querySelector(".new-text");t?t.innerText=i:(t=document.createElement("span"),t.innerText=i,t.className="new-text",this.inputBox.appendChild(t))},applyText:function(){var i=this.inputBox.querySelector(".new-text");i&&(i.className="",this.bindingData.inputText=this.inputBox.value)},hideDropdown:function(){this.element;t.removeClass(this.backDrop,"show"),t.removeClass(this.selectLanguage,"show")},showDropdown:function(i){var e=this.element,n=(e.querySelector("#language-list").winControl,!1);"auto"==Custom.Data.languageList.getAt(0).language_id&&(n=!0),"inputLang"==i&&(0==n&&Custom.Data.languageList.unshift({language_id:"auto",main:1}),t.removeClass(this.selectLanguage,"show-right"),t.addClass(this.selectLanguage,"show-left"),t.addClass(this.selectLanguage,"show")),"outputLang"==i&&(1==n&&Custom.Data.languageList.shift(),t.removeClass(this.selectLanguage,"show-left"),t.addClass(this.selectLanguage,"show-right"),t.addClass(this.selectLanguage,"show")),t.addClass(this.backDrop,"show")},swapLanguage:function(){if("auto"!=this.bindingData.inputLang){var i=this.element;WinJS.Utilities.toggleClass(i.querySelector("#swap"),"rotate");var t=this.bindingData.outputLang;this.bindingData.outputLang=this.bindingData.inputLang,this.bindingData.inputLang=t}},addTranslation:function(){var t=this;return i&&i.cancel(),WinJS.Promise.as().then(function(){var i=t.bindingData.inputLang,e=t.bindingData.outputLang,n=t.bindingData.inputText;return n.length<1?void 0:WinJS.Promise.as().then(function(){if(Custom.Utils.showNotif(WinJS.Resources.getString("translating").value),t.bindingData.historyList.length>0){var a=t.bindingData.historyList.getAt(0);if("live"==a.type&&(t.bindingData.historyList.splice(0,1),a.inputText==n&&a.inputLang==i&&a.outputLang==e))return a}return Custom.Translate.translate(i,e,n)}).then(function(i){return Custom.Utils.hideNotif(),i?(delete i.type,delete i.suggestedinputLang,delete i.suggestedinputText,Custom.SQLite.insertObject(Custom.SQLite.localDatabase,"history",i).then(function(i){t.bindingData.inputText="",i.type="normal",t.bindingData.historyList.unshift(i),t.bindingData.expandinputBox=!1})):Custom.Utils.popupNoInternet()})})},liveTranslation:function(){if(0!=l.values["realtime-translation"]&&1!=this.bindingData.expandinputBox){var t=this;i&&i.cancel(),i=WinJS.Promise.as().then(function(){var i=t.bindingData.inputLang,e=t.bindingData.outputLang,n=t.bindingData.inputText;return n.trim().length<1?(t.bindingData.historyList.length>0&&"live"==t.bindingData.historyList.getAt(0).type&&t.bindingData.historyList.splice(0,1),void("auto"==i&&(t.bindingData.tmpinputLang="auto"))):Custom.Translate.translate(i,e,n).then(function(e){if(!e)return void(t.bindingData.historyList.length>0&&"live"==t.bindingData.historyList.getAt(0).type&&t.bindingData.historyList.splice(0,1));if(t.bindingData.inputText==n){"auto"==i&&(t.bindingData.tmpinputLang=e.inputLang);e.type="live",e.id=null,t.bindingData.historyList.length>0&&"live"==t.bindingData.historyList.getAt(0).type?t.bindingData.historyList.splice(0,1,e):t.bindingData.historyList.unshift(e)}})})}},updateRecent:function(){var i=this.bindingData.inputLang,t=this.bindingData.outputLang,e=r.values.recent,n=[];e&&(n=JSON.parse(e));for(var a=Custom.Data.languageList.length-1;0==Custom.Data.languageList.getAt(a).main;)Custom.Data.languageList.pop(),a--;n.indexOf(i)<0&&"auto"!=i&&n.push(i),n.indexOf(t)<0&&n.push(t),n.splice(0,n.length-3),n.forEach(function(i){Custom.Data.languageList.push({language_id:i,language_name:WinJS.Resources.getString(i).value,main:0})}),r.values.recent=JSON.stringify(n)}})}();